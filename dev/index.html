<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Home · ColBERT</title><meta name="title" content="Home · ColBERT"/><meta property="og:title" content="Home · ColBERT"/><meta property="twitter:title" content="Home · ColBERT"/><meta name="description" content="Documentation for ColBERT."/><meta property="og:description" content="Documentation for ColBERT."/><meta property="twitter:description" content="Documentation for ColBERT."/><script data-outdated-warner src="assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="assets/documenter.js"></script><script src="search_index.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li class="is-active"><a class="tocitem" href>Home</a><ul class="internal"><li class="toplevel"><a class="tocitem" href="#Get-Started"><span>Get Started</span></a></li><li><a class="tocitem" href="#Dataset-and-preprocessing"><span>Dataset and preprocessing</span></a></li><li><a class="tocitem" href="#The-ColBERTConfig"><span>The <code>ColBERTConfig</code></span></a></li><li><a class="tocitem" href="#Building-the-index"><span>Building the index</span></a></li><li><a class="tocitem" href="#Searching"><span>Searching</span></a></li></ul></li><li><a class="tocitem" href="api/">Reference</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Home</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Home</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/JuliaGenAI/ColBERT.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/JuliaGenAI/ColBERT.jl/blob/main/docs/src/index.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="ColBERT:-Efficient,-late-interaction-retrieval-systems-in-Julia!"><a class="docs-heading-anchor" href="#ColBERT:-Efficient,-late-interaction-retrieval-systems-in-Julia!">ColBERT: Efficient, late-interaction retrieval systems in Julia!</a><a id="ColBERT:-Efficient,-late-interaction-retrieval-systems-in-Julia!-1"></a><a class="docs-heading-anchor-permalink" href="#ColBERT:-Efficient,-late-interaction-retrieval-systems-in-Julia!" title="Permalink"></a></h1><p><a href="https://codetalker7/colbert.jl">ColBERT.jl</a> is a pure Julia package for the ColBERT information retrieval system123, allowing developers to integrate this powerful neural retrieval algorithm into their own downstream tasks. ColBERT (contextualized late interaction over BERT) has emerged as a state-of-the-art approach for efficient and effective document retrieval, thanks to its ability to leverage contextualized embeddings from pre-trained language models like BERT.</p><p><a href="https://github.com/stanford-futuredata/ColBERT">Inspired from the original Python implementation of ColBERT</a>, with ColBERT.jl, you can now bring this capability to your Julia applications, whether you&#39;re working on natural language processing tasks, information retrieval systems, or other areas where relevant document retrieval is crucial. Our package provides a simple and intuitive interface for using ColBERT in Julia, making it easy to get started with this powerful algorithm.</p><h1 id="Get-Started"><a class="docs-heading-anchor" href="#Get-Started">Get Started</a><a id="Get-Started-1"></a><a class="docs-heading-anchor-permalink" href="#Get-Started" title="Permalink"></a></h1><p>To install the package, simply clone the repository and <code>dev</code> it:</p><pre><code class="language-julia-repl hljs">julia&gt; ] dev .</code></pre><p>Consult the <a href="https://github.com/JuliaGenAI/ColBERT.jl">README</a> of the GitHub repository for a small example. In this guide, we&#39;ll index a collection of 1000 documents.</p><h2 id="Dataset-and-preprocessing"><a class="docs-heading-anchor" href="#Dataset-and-preprocessing">Dataset and preprocessing</a><a id="Dataset-and-preprocessing-1"></a><a class="docs-heading-anchor-permalink" href="#Dataset-and-preprocessing" title="Permalink"></a></h2><p>We&#39;ll go through an example of the <code>lifestyle/dev</code> split of the <a href="https://github.com/stanford-futuredata/colbert/blob/main/lotte.md">LoTTe</a> dataset. To download the dataset, you can use the <code>examples/lotte.sh</code> script. We&#39;ll work with the first 1000 documents of the dataset:</p><pre><code class="language-shell hljs">$ cd examples
$ ./lotte.sh
$ head -n 1000 downloads/lotte/lifestyle/dev/collection.tsv &gt; 1kcollection.tsv
$ wc -l 1kcollection.tsv
1000 1kcollection.txt</code></pre><p>The <code>1kcollection.tsv</code> file has documents in the format <code>pid \t &lt;document text&gt;</code>, where <code>pid</code> is the unique ID of the document. For now, the package only supports collections which have one document per line. So, we&#39;ll simply remove the <code>pid</code> from each document in <code>1kcollection.tsv</code>, and save the resultant file of documents in <code>1kcollection.txt</code>. Here&#39;s a simple Julia script you can use to do this preprocessing using the <a href="https://github.com/JuliaData/CSV.jl">CSV.jl</a> package:</p><pre><code class="language-julia hljs">using CSV
file = CSV.File(&quot;1kcollection.tsv&quot;; delim = &#39;\t&#39;, header = [:pid, :text],
        types = Dict(:pid =&gt; Int, :text =&gt; String), debug = true, quoted = false)
for doc in file.text
    open(&quot;1kcollection.txt&quot;, &quot;a&quot;) do io
        write(io, doc*&quot;\n&quot;)
    end
end</code></pre><p>We now have our collection of documents to index!</p><h2 id="The-ColBERTConfig"><a class="docs-heading-anchor" href="#The-ColBERTConfig">The <code>ColBERTConfig</code></a><a id="The-ColBERTConfig-1"></a><a class="docs-heading-anchor-permalink" href="#The-ColBERTConfig" title="Permalink"></a></h2><p>To start off, make sure you download a ColBERT checkpoint somewhere in your system; for this example, I&#39;ll download the <code>colbert-ir/colbertv2.0</code> checkpoint in <code>$HOME/models</code>:</p><pre><code class="language-shell hljs">git lfs install
cd $HOME/models
git clone https://huggingface.co/colbert-ir/colbertv2.0</code></pre><p>The next step is to create a configuration object containing details about all parameters used during indexing/searching using ColBERT. All this information is contained in a type called <code>ColBERTConfig</code>. Creating a <code>ColBERTConfig</code> is easy; it has the right defaults for most users, and one can change the settings using simple kwargs. In this example, we&#39;ll create a config for the collection <code>1kcollection.txt</code> we just created, and we&#39;ll also use <a href="https://github.com/JuliaGPU/CUDA.jl">CUDA.jl</a> for GPU support (you can use any GPU backend supported by <a href="https://github.com/FluxML/Flux.jl">Flux.jl</a>)!</p><pre><code class="language-julia-repl hljs">julia&gt;  using ColBERT, CUDA, Random;

julia&gt;  Random.seed!(0)                                                 # global seed for a reproducible index

julia&gt;  config = ColBERTConfig(
            use_gpu = true,
            checkpoint = &quot;/home/codetalker7/models/colbertv2.0&quot;,        # local path to the colbert checkpoint
            collection = &quot;./1kcollection.txt&quot;,                          # local path to the collection
            doc_maxlen = 300,                                           # max length beyond which docs are truncated
            index_path = &quot;./1kcollection_index/&quot;,                       # local directory to save the index in
            chunksize = 200                                             # number of docs to store in a chunk
        );</code></pre><p>You can read more about a <code>ColBERTConfig</code> from it&#39;s docstring.</p><h2 id="Building-the-index"><a class="docs-heading-anchor" href="#Building-the-index">Building the index</a><a id="Building-the-index-1"></a><a class="docs-heading-anchor-permalink" href="#Building-the-index" title="Permalink"></a></h2><p>Building the index is even easier than creating a config; just build an <code>Indexer</code> and call the <code>index</code> function. I used an NVIDIA GeForce RTX 2020 Ti card to build the index:</p><pre><code class="language-julia-repl hljs">julia&gt;  indexer = Indexer(config);

julia&gt;  @time index(indexer)
[ Info: # of sampled PIDs = 636
[ Info: Encoding 636 passages.
[ Info: avg_doclen_est = 233.25157232704402      length(local_sample) = 636
[ Info: Creating 4096 clusters.
[ Info: Estimated 233251.572327044 embeddings.
[ Info: Saving the index plan to ./1kcollection_index/plan.json.
[ Info: Saving the config to the indexing path.
[ Info: Training the clusters.
[ Info: Iteration 1/20, max delta: 0.26976448
[ Info: Iteration 2/20, max delta: 0.17742664
[ Info: Iteration 3/20, max delta: 0.16281573
[ Info: Iteration 4/20, max delta: 0.120501295
[ Info: Iteration 5/20, max delta: 0.08808214
[ Info: Iteration 6/20, max delta: 0.14226294
[ Info: Iteration 7/20, max delta: 0.07096822
[ Info: Iteration 8/20, max delta: 0.081315234
[ Info: Iteration 9/20, max delta: 0.06760075
[ Info: Iteration 10/20, max delta: 0.07043305
[ Info: Iteration 11/20, max delta: 0.060436506
[ Info: Iteration 12/20, max delta: 0.048092205
[ Info: Iteration 13/20, max delta: 0.052080974
[ Info: Iteration 14/20, max delta: 0.055756018
[ Info: Iteration 15/20, max delta: 0.057068985
[ Info: Iteration 16/20, max delta: 0.05717972
[ Info: Iteration 17/20, max delta: 0.02952642
[ Info: Iteration 18/20, max delta: 0.025388952
[ Info: Iteration 19/20, max delta: 0.034007154
[ Info: Iteration 20/20, max delta: 0.047712516
[ Info: Got bucket_cutoffs_quantiles = [0.25, 0.5, 0.75] and bucket_weights_quantiles = [0.125, 0.375, 0.625, 0.875]
[ Info: Got bucket_cutoffs = Float32[-0.023658333, -9.9312514f-5, 0.023450013] and bucket_weights = Float32[-0.044035435, -0.010775891, 0.010555617, 0.043713447]
[ Info: avg_residual = 0.031616904
[ Info: Saving codec to ./1kcollection_index/centroids.jld2, ./1kcollection_index/avg_residual.jld2, ./1kcollection_index/bucket_cutoffs.jld2 and ./1kcollection_index/bucket_weights.jld2.
[ Info: Building the index.
[ Info: Loading codec from ./1kcollection_index/centroids.jld2, ./1kcollection_index/avg_residual.jld2, ./1kcollection_index/bucket_cutoffs.jld2 and ./1kcollection_index/bucket_weights.jld2.
[ Info: Encoding 200 passages.
[ Info: Saving chunk 1:          200 passages and 36218 embeddings. From passage #1 onward.
[ Info: Saving compressed codes to ./1kcollection_index/1.codes.jld2 and residuals to ./1kcollection_index/1.residuals.jld2
[ Info: Saving doclens to ./1kcollection_index/doclens.1.jld2
[ Info: Saving metadata to ./1kcollection_index/1.metadata.json
[ Info: Encoding 200 passages.
[ Info: Saving chunk 2:          200 passages and 45064 embeddings. From passage #201 onward.
[ Info: Saving compressed codes to ./1kcollection_index/2.codes.jld2 and residuals to ./1kcollection_index/2.residuals.jld2
[ Info: Saving doclens to ./1kcollection_index/doclens.2.jld2
[ Info: Saving metadata to ./1kcollection_index/2.metadata.json
[ Info: Encoding 200 passages.
[ Info: Saving chunk 3:          200 passages and 50956 embeddings. From passage #401 onward.
[ Info: Saving compressed codes to ./1kcollection_index/3.codes.jld2 and residuals to ./1kcollection_index/3.residuals.jld2
[ Info: Saving doclens to ./1kcollection_index/doclens.3.jld2
[ Info: Saving metadata to ./1kcollection_index/3.metadata.json
[ Info: Encoding 200 passages.
[ Info: Saving chunk 4:          200 passages and 49415 embeddings. From passage #601 onward.
[ Info: Saving compressed codes to ./1kcollection_index/4.codes.jld2 and residuals to ./1kcollection_index/4.residuals.jld2
[ Info: Saving doclens to ./1kcollection_index/doclens.4.jld2
[ Info: Saving metadata to ./1kcollection_index/4.metadata.json
[ Info: Encoding 200 passages.
[ Info: Saving chunk 5:          200 passages and 52304 embeddings. From passage #801 onward.
[ Info: Saving compressed codes to ./1kcollection_index/5.codes.jld2 and residuals to ./1kcollection_index/5.residuals.jld2
[ Info: Saving doclens to ./1kcollection_index/doclens.5.jld2
[ Info: Saving metadata to ./1kcollection_index/5.metadata.json
[ Info: Running some final checks.
[ Info: Checking if all files are saved.
[ Info: Found all files!
[ Info: Collecting embedding ID offsets.
[ Info: Saving the indexing metadata.
[ Info: Building the centroid to embedding IVF.
[ Info: Loading codes for each embedding.
[ Info: Sorting the codes.
[ Info: Getting unique codes and their counts.
[ Info: Saving the IVF.
151.833047 seconds (78.15 M allocations: 28.871 GiB, 41.12% gc time, 0.51% compilation time: &lt;1% of which was recompilation)</code></pre><h2 id="Searching"><a class="docs-heading-anchor" href="#Searching">Searching</a><a id="Searching-1"></a><a class="docs-heading-anchor-permalink" href="#Searching" title="Permalink"></a></h2><p>Once you&#39;ve built the index for your collection of docs, it&#39;s now time to perform a query search. This involves creating a <code>Searcher</code> from the path of the index:</p><pre><code class="language-julia-repl hljs">julia&gt;  using ColBERT, CUDA;

julia&gt;  searcher = Searcher(&quot;1kcollection_index&quot;);</code></pre><p>Next, simply feed a query to the search function, and get the top-k best documents for your query:</p><pre><code class="language-julia-repl hljs">julia&gt;  query = &quot;what is 1080 fox bait poisoning?&quot;;

julia&gt;  @time pids, scores = search(searcher, query, 10)            # second run statistics
  0.136773 seconds (1.95 M allocations: 240.648 MiB, 0.00% compilation time)
([999, 383, 386, 323, 547, 385, 384, 344, 963, 833], Float32[8.754782, 7.6871076, 6.8440857, 6.365711, 6.323611, 6.1222105, 5.92911, 5.708316, 5.597268, 5.4987035])</code></pre><p>You can now use these pids to see which documents match the best against your query:</p><pre><code class="language-julia-repl hljs">julia&gt; print(readlines(&quot;1kcollection.txt&quot;)[pids[1]])
Tl;dr - Yes, it sounds like a possible 1080 fox bait poisoning. Can&#39;t be sure though. The traditional fox bait is called 1080. That poisonous bait is still used in a few countries to kill foxes, rabbits, possums and other mammal pests. The toxin in 1080 is Sodium fluoroacetate. Wikipedia is a bit vague on symptoms in animals, but for humans they say: In humans, the symptoms of poisoning normally appear between 30 minutes and three hours after exposure. Initial symptoms typically include nausea, vomiting and abdominal pain; sweating, confusion and agitation follow. In significant poisoning, cardiac abnormalities including tachycardia or bradycardia, hypotension and ECG changes develop. Neurological effects include muscle twitching and seizures... One might safely assume a dog, especially a small Whippet, would show symptoms of poisoning faster than the 30 mins stated for humans. The listed (human) symptoms look like a good fit to what your neighbour reported about your dog. Strychnine is another commonly used poison against mammal pests. It affects the animal&#39;s muscles so that contracted muscles can no longer relax. That means the muscles responsible of breathing cease to operate and the animal suffocates to death in less than two hours. This sounds like unlikely case with your dog. One possibility is unintentional pet poisoning by snail/slug baits. These baits are meant to control a population of snails and slugs in a garden. Because the pelletized bait looks a lot like dry food made for dogs it is easily one of the most common causes of unintentional poisoning of dogs. The toxin in these baits is Metaldehyde and a dog may die inside four hours of ingesting these baits, which sounds like too slow to explain what happened to your dog, even though the symptoms of this toxin are somewhat similar to your case. Then again, the malicious use of poisons against neighbourhood dogs can vary a lot. In fact they don&#39;t end with just pesticides but also other harmful matter, like medicine made for humans and even razorblades stuck inside a meatball, have been found in baits. It is quite impossible to say what might have caused the death of your dog, at least without autopsy and toxicology tests. The 1080 is just one of the possible explanations. It is best to always use a leash when walking dogs in populated areas and only let dogs free (when allowed by local legislation) in unpopulated parks and forests and suchlike places.</code></pre></article><nav class="docs-footer"><a class="docs-footer-nextpage" href="api/">Reference »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.7.0 on <span class="colophon-date" title="Saturday 28 September 2024 10:30">Saturday 28 September 2024</span>. Using Julia version 1.10.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
